<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support - GlobalTrade360</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <i class="fas fa-chart-line"></i>
                <span>GlobalTrade<span class="logo-highlight">360</span></span>
            </div>
        </div>
        
        <nav class="sidebar-nav">
            <a href="/dashboard" class="nav-item">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </a>
            <a href="/support" class="nav-item active">
                <i class="fas fa-headset"></i>
                <span>Support</span>
            </a>
            <a href="#" class="nav-item logout" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </a>
        </nav>
    </div>
    
    <div class="main-content">
        <div class="topbar">
            <div class="topbar-left">
                <h2>Customer Support</h2>
            </div>
            <div class="topbar-right">
                <div class="balance-display">
                    <span id="userName">Loading...</span>
                </div>
            </div>
        </div>
        
        <div class="dashboard-content">
            <div class="support-container">
                <div class="support-card">
                    <h3><i class="fas fa-envelope"></i> Contact Support</h3>
                    <p>Send us a message and we'll respond within 24 hours.</p>
                    
                    <form id="supportForm">
                        <div class="form-group">
                            <label>Subject</label>
                            <input type="text" id="subject" placeholder="What do you need help with?" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Your Message</label>
                            <textarea id="message" rows="6" placeholder="Describe your issue in detail..." required></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i> Send Message
                        </button>
                    </form>
                </div>
                
                <div class="support-info">
                    <h3><i class="fas fa-info-circle"></i> Support Information</h3>
                    
                    <div class="info-box">
                        <h4><i class="fas fa-clock"></i> Response Time</h4>
                        <p>We typically respond within 2-24 hours</p>
                    </div>
                    
                    <div class="info-box">
                        <h4><i class="fas fa-envelope"></i> Email Support</h4>
                        <p>support@globaltrade360.com</p>
                    </div>
                    
                    <div class="info-box">
                        <h4><i class="fas fa-phone"></i> Phone Support</h4>
                        <p>+1 (555) 123-4567</p>
                        <p>Mon-Fri: 9AM-6PM EST</p>
                    </div>
                    
                    <div class="info-box">
                        <h4><i class="fas fa-question-circle"></i> Common Issues</h4>
                        <ul>
                            <li>Deposit not showing?</li>
                            <li>Withdrawal pending?</li>
                            <li>Trading issues?</li>
                            <li>Account verification?</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="message-history" id="messageHistory">
                <h3>Your Messages</h3>
                <div id="messagesList">
                    <p class="no-messages">No messages yet</p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Load user info
        async function loadUserInfo() {
            try {
                const response = await fetch('/api/session');
                const data = await response.json();
                
                if (data.authenticated) {
                    document.getElementById('userName').textContent = data.user.username;
                } else {
                    window.location.href = '/login';
                }
            } catch (error) {
                console.error('Failed to load user info:', error);
            }
        }
        
        // Send support message
        document.getElementById('supportForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const subject = document.getElementById('subject').value;
            const message = document.getElementById('message').value;
            
            try {
                const response = await fetch('/api/support/message', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ subject, message })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('Message sent successfully! We will respond within 24 hours.');
                    this.reset();
                    loadMessages();
                } else {
                    alert('Failed to send message: ' + data.error);
                }
            } catch (error) {
                alert('Network error. Please try again.');
            }
        });
        
        // Load messages
        async function loadMessages() {
            // For user messages, we'd need an API endpoint
            // For now, just show placeholder
        }
        
        // Logout function
        async function logout() {
            try {
                await fetch('/api/logout', { method: 'POST' });
                window.location.href = '/login';
            } catch (error) {
                console.error('Logout failed:', error);
            }
        }
        
        // Initialize
        loadUserInfo();
        loadMessages();
    </script>
</body>
</html>
